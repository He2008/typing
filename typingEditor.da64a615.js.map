{"version":3,"sources":["typingEditor/config.ts","typingEditor/utils.ts","typingEditor/view.ts","typingEditor/index.ts"],"names":[],"mappings":"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","file":"typingEditor.da64a615.js","sourceRoot":"../src","sourcesContent":["const java = \n`\npublic class StringCompareEmp{\n    public static void main(String args[]){\n       String str = \"Hello World\";\n       String anotherString = \"hello world\";\n       Object objStr = str;\n  \n       System.out.println( str.compareTo(anotherString) );\n       System.out.println( str.compareToIgnoreCase(anotherString) );\n       System.out.println( str.compareTo(objStr.toString()));\n    }\n }\n`\nconst js = \n`\ndocument.ready = function (callback) {\n    if (document.addEventListener) {\n        document.addEventListener('DOMContentLoaded', function () {\n            document.removeEventListener('DOMContentLoaded', arguments.callee, false);\n            callback();\n        }, false)\n    }\n    else if (document.attachEvent) {\n        document.attachEvent('onreadystatechange', function () {\n              if (document.readyState == \"complete\") {\n                        document.detachEvent(\"onreadystatechange\", arguments.callee);\n                        callback();\n               }\n        })\n    }\n    else if (document.lastChild == document.body) {\n        callback();\n    }\n}\n`\nconst line = `this is a line!`\n\n\nexport default{\ncontent:java,\njava,\njs\n\n}\n","const utils = {\n  hasClass,\n  addClass,\n  remove,\n  timeLeft\n};\n\n/**\n *@desc 判断是否有某个Class\n *@param {HTMLElement} el 元素\n *@param {string} className 类名\n *@return {boolean}\n */\nfunction hasClass(el: HTMLElement, className: string): boolean {\n  return new RegExp(\"(\\\\s|^)\" + className + \"(\\\\s|$)\").test(el.className);\n}\n/**\n * @desc 添加Class\n * @param el 元素\n * @param className 类名\n */\nfunction addClass(el: HTMLElement, className: string) {\n  if (hasClass(el, className)) return false;\n  el.className += \" \" + className;\n}\n\nfunction remove(el: HTMLElement, className: string) {\n  if (hasClass(el, className)) {\n    let reg = new RegExp(\"(\\\\s|^)\" + className + \"(\\\\s|$)\");\n    el.className = el.className.replace(reg, \" \");\n  }\n}\n/**\n * @desc startTime - endTime 剩余时间\n * @param   startTime\n * @param   endTime\n * @return Object {d,h,m,s} 天时分秒\n */\nfunction timeLeft(startTime: Date, endTime: Date): any {\n  if (!startTime || !endTime) {\n    return false;\n  }\n  let t = endTime.getTime() - startTime.getTime();\n  let d = 0,\n    h = 0,\n    m = 0,\n    s = 0,\n    format = '0';\n  if (t > 0) {\n    d = t / 3600 / 24 / 1000;\n    h = Math.floor((t / 1000 / 60 / 60) % 24);\n    m = Math.floor((t / 1000 / 60) % 60);\n    s = Math.floor((t / 1000) % 60);\n    format = `${m}分${s}秒`\n  }\n  return {d,h,m,s,format}\n}\n\nexport default utils;\nwindow.utils = utils;\n","\nimport Utils from './utils'\nexport class CharBlock {\n    char: string;\n    type: CharBlockType;\n    isActive: boolean = false;\n    html: HTMLElement;\n    constructor(char: string, type: CharBlockType = \"default\") {\n      this.char = char;\n      this.type = type;\n      this.html = document.createElement(\"span\");\n      this.initCharHtml();\n      this.changeType(type);\n    }\n    initCharHtml() {\n      let char = this.char;\n      this.html.innerHTML = char;\n    }\n    changeType(type: CharBlockType) {\n        if(this.type === 'end') return\n      this.html.className = `char ${type} ${this.isActive ? \"isActive\" : \"\"}`;\n    }\n    toggleActive(isActive: boolean) {\n      this.isActive = isActive;\n      if (this.isActive) {\n        Utils.addClass(this.html, \"isActive\");\n      } else {\n        Utils.remove(this.html, \"isActive\");\n      }\n    }\n  }\n  \n  export  class Line {\n    html: HTMLElement;\n    lineNo: number;\n    charList: CharBlock[] = [];\n    constructor(lineText: string[], type) {\n      this.initLine(lineText, type);\n    }\n    initLine(text: string[], type: String) {\n      this.html = document.createElement(\"p\");\n      Utils.addClass(this.html, \"line\");\n      text.forEach(char => {\n        let blockType: CharBlockType =\n          type === \"input\" ? \"transparent\" : \"default\";\n        if (char === \"indent\") {\n          blockType = \"indent\";\n          char = \"&nbsp\";\n        }else if(char ==='end'){\n          blockType = \"end\";\n          char = \"&nbsp\";\n        }\n        let charBlock = new CharBlock(char, blockType);\n        this.charList.push(charBlock);\n        this.html.append(charBlock.html);\n      });\n    }\n  }\n  \n  export   class View {\n    html: HTMLElement;\n    text: string;\n    lineList: Line[] = [];\n  \n    constructor(text: string, type: string) {\n      this.text = text;\n      this.html = document.createElement(\"div\");\n      Utils.addClass(this.html, type);\n      this.handleText(type);\n    }\n    handleText(type) {\n      let text = this.text;\n      let line = [];\n      let char: string;\n      let indent = true;\n      for (let i = 0; i < text.length; i++) {\n        char = text[i];\n        if (!char || char === \" \") {\n          char = indent ? \"indent\" : \"&nbsp;\";\n        } else if (char === \"\\r\\n\" || char === \"\\n\") {\n          let lineClass = new Line(line, type);\n          this.lineList.push(lineClass);\n          this.html.append(lineClass.html);\n          line = [];\n          indent = true;\n          continue;\n        } else {\n          indent = false;\n        }\n        line.push(char);\n      }\n      line.push('end')\n      let lineClass = new Line(line, type);\n      this.lineList.push(lineClass);\n      this.html.append(lineClass.html);\n    }\n  }\n  ","import C from \"./config\";\nimport Utils from \"./utils\";\nimport { View } from \"./view\";\n\n/**\n * @desc Typing 类\n * @\n */\nclass Typing {\n  el: HTMLElement;\n  displayView: View;\n  inputView: View;\n  index: number[] = [0, 0];\n  analysis: Analysis;\n  /**\n   * 创建Typing实例\n   * @param config.text 文章内容\n   * @param config.el 挂载的htmlElement\n   */\n  constructor(config: TypingConfig) {\n    this.el = config.el;\n    let wrap = document.createElement(\"div\");\n    Utils.addClass(wrap, \"screen-warp\");\n    this.displayView = new View(config.text, \"display\");\n    this.inputView = new View(config.text, \"input\");\n    this.analysis = new Analysis();\n    wrap.append(this.displayView.html, this.inputView.html);\n    this.el.append(this.analysis.html, wrap);\n    this.handleKeyEvent();\n  }\n\n  /**\n   * 监听键盘输入\n   */\n  handleKeyEvent() {\n    window.onkeydown = (event: any) => {\n      let code: Number = event.keyCode;\n      let key = event.key;\n      let lineIndex = () => this.index[1];\n      let charIndex = () => this.index[0];\n      let inputBlock = () =>\n        this.inputView.lineList[lineIndex()].charList[charIndex()];\n      let displayBlock = () =>\n        this.displayView.lineList[lineIndex()].charList[charIndex()];\n      // input text\n      if (\n        (code > 47 && code < 59) ||\n        (code > 64 && code < 91) ||\n        (code > 185 && code < 223) ||\n        code === 32\n      ) {\n        let type: wordBlockType = \"correct\";\n        if (key === \" \") {\n          key = \"&nbsp;\";\n          if (event.preventDefault) {\n            event.preventDefault();\n          } else {\n            window.event.returnValue = false;\n          }\n        }\n        if (key !== displayBlock().char) {\n          type = \"error\";\n          this.analysis.errorInput();\n        }\n        if (displayBlock().type === \"end\") {\n          this.analysis.endInput();\n        }\n        displayBlock().changeType(\"transparent\");\n        inputBlock().changeType(type);\n        this.moveIndex(\"forward\");\n\n        // 计数\n        this.analysis.addInput();\n        // 阻止浏览器默认\n      }\n      // ENTER\n      if (code === 13) {\n      }\n      // back\n      if (code === 8) {\n        this.moveIndex(\"back\");\n        displayBlock().changeType(\"default\");\n        inputBlock().changeType(\"transparent\");\n      }\n    };\n  }\n  /**\n   * 移动光标\n   * @param type 移动方向\n   */\n  moveIndex(type: string) {\n    let lineIndex = this.index[1];\n    let charIndex = this.index[0];\n    let line = () => {\n      return this.displayView.lineList[this.index[1]];\n    };\n    let char = () => {\n      return line().charList[this.index[0]];\n    };\n    char().toggleActive(false);\n\n    if (type === \"forward\") {\n      if (checkEnd(this.displayView)) return;\n      if (charIndex >= line().charList.length - 1) {\n        this.index[0] = 0;\n        this.index[1]++;\n      } else {\n        this.index[0]++;\n      }\n    } else if (type === \"back\") {\n      if (checkStart(this.displayView)) return;\n      if (charIndex > 0 && char().type !== \"indent\") {\n        this.index[0]--;\n      } else {\n        this.index[1]--;\n        this.index[0] = line().charList.length - 1;\n      }\n    }\n    char().toggleActive(true);\n    if (char().type === \"indent\") this.moveIndex(type);\n\n    function checkEnd(view: View) {\n      return (\n        lineIndex === view.lineList.length - 1 &&\n        line().charList.length - 1 === charIndex\n      );\n    }\n    function checkStart(view: View) {\n      return lineIndex === 0 && charIndex === 0;\n    }\n  }\n}\n\nclass Analysis {\n  html: HTMLElement;\n  time: Time;\n  inputNum: number = 0;\n  errorNum: number = 0;\n  result: any;\n  isEnd: boolean = false;\n  timer: number;\n  constructor() {\n    this.time = new Time();\n    this.html = document.createElement(\"div\");\n    Utils.addClass(this.html, \"analysis\");\n    this.timer = setInterval(() => {\n      if (this.isEnd) {\n        clearInterval(this.timer);\n      }\n      this.appendHtml();\n    }, 1000);\n  }\n  addInput() {\n    if (this.isEnd) return;\n    if (this.inputNum === 0) {\n      this.time.setStart();\n    }\n    this.inputNum++;\n    this.handleData();\n  }\n  errorInput() {\n    if (this.isEnd) return;\n    this.errorNum++;\n  }\n  endInput() {\n    if (this.isEnd) return;\n    this.isEnd = true;\n    this.time.setEnd();\n  }\n  handleData() {\n    this.result = {\n      totalTime: this.time.total,\n      totalInput: this.inputNum,\n      error: this.errorNum,\n      correctRate: this.errorNum / this.inputNum\n    };\n  }\n  appendHtml() {\n    this.time.handleCostTime();\n    this.handleData();\n    let r = this.result;\n    let html = `<span>用时:${r.totalTime.format || \"0\"}</span><span>总输入:${\n      r.totalInput\n    }</span><span>错误:${r.error}</span><span>正确率:${Math.ceil(\n      r.correctRate * 100\n    )}</span>`;\n    this.html.innerHTML = html;\n  }\n}\n\nclass Time {\n  start: Date;\n  end: Date;\n  total: string;\n  timer: number;\n  constructor() {}\n  setStart() {\n    this.start = new Date();\n  }\n  setEnd() {\n    this.end = new Date();\n    this.handleCostTime();\n  }\n  handleCostTime() {\n    let end = new Date();\n    if (this.end) {\n      end = this.end;\n    }\n    this.total = Utils.timeLeft(this.start, end);\n  }\n}\n\n// 主函数\nfunction __main__() {\n  let config: TypingConfig = {\n    el: document.getElementById(\"typing\"),\n    text: C.content.trim()\n  };\n  let typing = new Typing(config);\n}\n\nwindow.onload = function() {\n  __main__();\n};\n"]}